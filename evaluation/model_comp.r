# Load necessary libraries
library(tidyverse)

# Recreate the data in a tidy format
accuracy_data <- tribble(
    ~Dataset,
    ~Model,
    ~Method,
    ~Temperature,
    ~Accuracy,
    "GTSRB",
    "LLAMA",
    "Tree-based",
    "T=0",
    3.71,
    "GTSRB",
    "LLAMA",
    "Tree-based",
    "T=0.7",
    28.06,
    "GTSRB",
    "LLAMA",
    "Tree + History",
    "T=0",
    11.20,
    "GTSRB",
    "LLAMA",
    "Tree + History",
    "T=0.7",
    8.90,
    "GTSRB",
    "LLAMA",
    "Tree + Class Description",
    "T=0",
    13.23,
    "GTSRB",
    "LLAMA",
    "Tree + Class Description",
    "T=0.7",
    12.02,
    "GTSRB",
    "LLAMA",
    "Zero-shot",
    "T=0",
    19.68,
    "GTSRB",
    "LLAMA",
    "Zero-shot",
    "T=0.7",
    21.59,
    "GTSRB",
    "LLAMA",
    "Zero-shot + Class Description",
    "T=0",
    19.16,
    "GTSRB",
    "LLAMA",
    "Zero-shot + Class Description",
    "T=0.7",
    21.24,
    "GTSRB",
    "Qwen-VL",
    "Tree-based",
    "T=0",
    32.81,
    "GTSRB",
    "Qwen-VL",
    "Tree-based",
    "T=0.7",
    22.89,
    "GTSRB",
    "Qwen-VL",
    "Tree + History",
    "T=0",
    26.85,
    "GTSRB",
    "Qwen-VL",
    "Tree + History",
    "T=0.7",
    26.85,
    "GTSRB",
    "Qwen-VL",
    "Tree + Class Description",
    "T=0",
    42.24,
    "GTSRB",
    "Qwen-VL",
    "Tree + Class Description",
    "T=0.7",
    43.57,
    "GTSRB",
    "Qwen-VL",
    "Zero-shot",
    "T=0",
    40.18,
    "GTSRB",
    "Qwen-VL",
    "Zero-shot",
    "T=0.7",
    39.88,
    "GTSRB",
    "Qwen-VL",
    "Zero-shot + Class Description",
    "T=0",
    40.46,
    "GTSRB",
    "Qwen-VL",
    "Zero-shot + Class Description",
    "T=0.7",
    40.15,
    "GTSRB",
    "GPT-4o",
    "Tree-based",
    "T=0",
    52.05,
    "GTSRB",
    "GPT-4o",
    "Tree-based",
    "T=0.7",
    50.10,
    "GTSRB",
    "GPT-4o",
    "Tree + History",
    "T=0",
    49.17,
    "GTSRB",
    "GPT-4o",
    "Tree + History",
    "T=0.7",
    49.92,
    "GTSRB",
    "GPT-4o",
    "Tree + Class Description",
    "T=0",
    62.69,
    "GTSRB",
    "GPT-4o",
    "Tree + Class Description",
    "T=0.7",
    61.07,
    "GTSRB",
    "GPT-4o",
    "Zero-shot",
    "T=0",
    65.78,
    "GTSRB",
    "GPT-4o",
    "Zero-shot",
    "T=0.7",
    65.97,
    "GTSRB",
    "GPT-4o",
    "Zero-shot + Class Description",
    "T=0",
    64.93,
    "GTSRB",
    "GPT-4o",
    "Zero-shot + Class Description",
    "T=0.7",
    65.06,
    "CIFAR-10",
    "LLAMA",
    "Tree-based",
    "T=0",
    17.10,
    "CIFAR-10",
    "LLAMA",
    "Tree-based",
    "T=0.7",
    16.40,
    "CIFAR-10",
    "LLAMA",
    "Tree + History",
    "T=0",
    12.30,
    "CIFAR-10",
    "LLAMA",
    "Tree + History",
    "T=0.7",
    14.10,
    "CIFAR-10",
    "LLAMA",
    "Tree + Class Description",
    "T=0",
    4.80,
    "CIFAR-10",
    "LLAMA",
    "Tree + Class Description",
    "T=0.7",
    6.00,
    "CIFAR-10",
    "LLAMA",
    "Zero-shot",
    "T=0",
    46.87,
    "CIFAR-10",
    "LLAMA",
    "Zero-shot",
    "T=0.7",
    38.90,
    "CIFAR-10",
    "LLAMA",
    "Zero-shot + Class Description",
    "T=0",
    50.85,
    "CIFAR-10",
    "LLAMA",
    "Zero-shot + Class Description",
    "T=0.7",
    42.68,
    "CIFAR-10",
    "Qwen-VL",
    "Tree-based",
    "T=0",
    56.60,
    "CIFAR-10",
    "Qwen-VL",
    "Tree-based",
    "T=0.7",
    56.60,
    "CIFAR-10",
    "Qwen-VL",
    "Tree + History",
    "T=0",
    33.00,
    "CIFAR-10",
    "Qwen-VL",
    "Tree + History",
    "T=0.7",
    33.00,
    "CIFAR-10",
    "Qwen-VL",
    "Tree + Class Description",
    "T=0",
    66.50,
    "CIFAR-10",
    "Qwen-VL",
    "Tree + Class Description",
    "T=0.7",
    66.30,
    "CIFAR-10",
    "Qwen-VL",
    "Zero-shot",
    "T=0",
    77.60,
    "CIFAR-10",
    "Qwen-VL",
    "Zero-shot",
    "T=0.7",
    77.60,
    "CIFAR-10",
    "Qwen-VL",
    "Zero-shot + Class Description",
    "T=0",
    76.00,
    "CIFAR-10",
    "Qwen-VL",
    "Zero-shot + Class Description",
    "T=0.7",
    75.93,
    "CIFAR-10",
    "GPT-4o",
    "Tree-based",
    "T=0",
    75.40,
    "CIFAR-10",
    "GPT-4o",
    "Tree-based",
    "T=0.7",
    76.00,
    "CIFAR-10",
    "GPT-4o",
    "Tree + History",
    "T=0",
    73.10,
    "CIFAR-10",
    "GPT-4o",
    "Tree + History",
    "T=0.7",
    72.80,
    "CIFAR-10",
    "GPT-4o",
    "Tree + Class Description",
    "T=0",
    82.70,
    "CIFAR-10",
    "GPT-4o",
    "Tree + Class Description",
    "T=0.7",
    80.60,
    "CIFAR-10",
    "GPT-4o",
    "Zero-shot",
    "T=0",
    89.60,
    "CIFAR-10",
    "GPT-4o",
    "Zero-shot",
    "T=0.7",
    87.90,
    "CIFAR-10",
    "GPT-4o",
    "Zero-shot + Class Description",
    "T=0",
    89.67,
    "CIFAR-10",
    "GPT-4o",
    "Zero-shot + Class Description",
    "T=0.7",
    87.90,
)

# view, a bit more compact
accuracy_data %>%
    mutate(
        Method = str_replace(Method, 'Class Description', 'Desc.'),
         Method = str_replace(Method, 'Zero-shot', 'ZS'),
        Method = factor(
            Method,
            levels = c(
                "Tree + History",
                "Tree + Desc.",
                "Tree-based",
                "ZS",
                "ZS + Desc."
            )
        )
    ) %>%
    ggplot() +
    aes(Method, Accuracy) +
    facet_grid(Dataset ~ Model) +
    geom_line(
        aes(group = interaction(Method), colour = Method),
        show.legend = FALSE
    ) +
    geom_point(aes(shape = Temperature)) +
    scale_shape_manual(values = c(1, 4)) +
    scale_x_discrete(NULL) +
    scale_y_continuous(
        labels = scales::percent_format(scale = 1),
        breaks = c(0, 25, 50, 75, 100),
    ) +
    coord_flip() +
    theme_bw() +
    theme(
        strip.text = element_text(colour = 'white'),
        strip.background = element_rect(fill = 'black', colour = 'black'),
        legend.position = 'bottom',
        plot.margin = margin(0, 0, 0, 0, "cm"),
        legend.margin = margin(0, 0, 0, 0, "cm"),
        legend.key.height = unit(0.5, "cm")
    )

ggsave('results/full_results.pdf', width = 6, height = 2.5, device = cairo_pdf)